<!doctype html><html lang="en"><head><meta http-equiv="Content-type" content="text/html;charset=UTF-8"><meta name="Viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0"><meta name="Description" content="Homepage of Richard Wossal. Weeks of hacking can save you hours of planning."><title>I'm Back - And It Hurts | r-wos.org</title> <style>
    * { line-height: 140%; }
    body { margin:15px auto; max-width:40em; padding: 0 1em; }
    @-moz-keyframes blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@-webkit-keyframes blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@-o-keyframes blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@keyframes blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}blink{display:inline;-webkit-animation:blink 1s steps(1) infinite;-moz-animation:blink 1s steps(1) infinite;-o-animation:blink 1s steps(1) infinite;animation:blink 1s steps(1) infinite}

    </style></head><body> <nav> <a href="/">Home</a> - <a href="/blog">Blog</a> - <a href="/feed.xml">RSS</a> - <a href="/hacks">Hacks</a> - <a href="/about">About</a> </nav> <main><h1>I'm Back - And It Hurts</h1><p><time datetime="2011-07-23">2011-07-23</time></p><p>Working with strings is painful in C. I knew that.</p><p>But I have completely forgotten, <em>how</em> brain-shattering painful it is.</p><p>I guess it’s common knowledge, but let’s recap some of the issues:</p><ul><li><code class="highlighter-rouge">strlen()</code> <em>does</em> give you the string’s length - but only in a very strict sense. It does <em>not</em> give you the string’s size. That would be one byte more.</li><li>A simple <code class="highlighter-rouge">strlen()</code> call on garbage (that is, a perfect valid string but without the terminating NUL byte, for example) will very likely run until your process segfaults.</li><li><code class="highlighter-rouge">strcpy()</code>, which copies a string to another location, absolutely needs a destination that must be of at least the source’s size and a source that is NUL-terminated. So you’ll have to check for that. Oh, and yes, <code class="highlighter-rouge">strcpy()</code> will happily wreck total havoc if you fail to provide it, of course.</li><li><code class="highlighter-rouge">strncpy()</code> is somewhat better, using an additional parameter that limits the bytes copied. That eliminates the “the destination must be of some uncertain size” problem, but introduces new problems in return: If there is no NUL byte among the n bytes that you want to have copied, the destination will not be NUL-terminated. That is, <em>it will be no string</em>. See above for what that means in C. So, you’ll have to include checks, too  - which completely defeats the purpose of choosing <code class="highlighter-rouge">strncpy()</code> over the faster <code class="highlighter-rouge">strcpy()</code>.</li><li>Because of the very nature of “strings” in C, <code class="highlighter-rouge">strlen()</code> is of linear time complexity, making string concatenations, for example, much slower than needed.</li><li>etc.</li></ul><p>And yes, I know that those pitfalls (and many more) are well-documented in the man pages. I know that C strings are of unmatched space efficiency. I know that it was the only possible way to get unlimited strings on machines with a 64k core.</p><p>And it’s not that it was <em>impossible</em> to work with standard strings in C. It’s just <em>much harder than it needs to be</em>. And much more dangerous.</p><p>It’s like [insert crazy rhetoric figure, comparing working with C strings with [doing normal stuff] using [highly dangerous equipment]].</p><p>Or something like that.</p><p>PS: Just in case this isn’t clear to everyone: C is a programming language. In fact, C is a pretty <em>good</em> programming language. I like it very much. It’s a piece of cake to implement better strings in C, custom made for your needs. Only the string implementation of the standard library is, well, a bit <em>unpleasant</em> to use.</p><hr><h2>See Also</h2><p>Previously: <a href="/blog/join-the-tiling-side">Join The Tiling Side</a></p><p>Next up: <a href="/blog/you-can-t-escape-the-string-escape">You Can't Escape The String Escape</a></p><p> The machine thinks that the Web-Log entries <a href="/blog/ludum-dare-26-postmortem">26th Ludum Dare - Postmortem</a>, <a href="/blog/gherkin">Given When Then</a>, and <a href="/blog/german-programming-apprenticeship-review">The German Programming Apprenticeship - A Review</a> might be related to the topic so eloquently discussed above. The machine is sometimes right.</p></main></body></html>